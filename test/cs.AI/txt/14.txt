jmlr
workshopandconferenceproceedings80:1–16,2017acml2017computerassistedcompositionwithrecurrentneuralnetworkschristianwalderchristian.walder
data61.csiro.audata61atcsiro
australia.dongwookimdongwoo.kim
anu.edu.auaustraliannationaluniversity.editors
yung-kyunnohandmin-lingzhangabstractsequencemodelingwithneuralnetworkshasleadtopowerfulmodelsofsymbolicmusicdata.weaddresstheproblemofexploitingthesemodelstoreachcreativemusicalgoals
bycombiningwithhumaninput.tothisendwegeneralisepreviouswork
whichsampledmarkoviansequencemodelsundertheconstraintthatthesequencebelongtothelanguageofagivenﬁnitestatemachineprovidedbythehuman.weconsidermoreexpressivenon-markovmodels
therebyrequiringapproximatesamplingwhichweprovideintheformofaneﬃcientsequentialmontecarlomethod.inadditionweprovideandcomparewithabeamsearchstrategyforconditionalprobabilitymaximisation.ouralgorithmsarecapableofconvincinglyre-harmonisingfamousmusicalworks.todemonstratethisweprovidevisualisations
quantitativeexperiments
ahumanlisteningtestandaudioexamples.weﬁndboththesamplingandoptimisationprocedurestobeeﬀective
yetcomplementaryincharacter.forthecaseofhighlypermissiveconstraintsets
weﬁndthatsamplingistobepreferredduetotheoverlyregularnatureoftheoptimisationbasedresults.thegeneralityofouralgorithmspermitscountlessothercreativeapplications.keywords
music
sequencemodels
composition
neuralnetworks.1.introductionalgorithmicmusiccompositionhasintriguedawiderangeofthinkers
fromtimesasdistantastheearliestdaysofmoderncomputing
andbeyond.asearlyas1843
adalovelacefamouslyspeculatedthatacomputer
mightcomposeelaborateandscientiﬁcpiecesofmusicofanydegreeofcomplexityorextent
menabreaandlovelace,1843
.stillearlier
around1757
therefamouslyexistedanumberofmusicalgameswhichuseddicealongwithpreciseinstructions
togeneratemusicalcompositions
nierhaus,2008
.muchworkhasfocusedonmachinelearningmethods
whichcombinemusicalexampleswithgenericinductiveprinciples
togeneratenewexamples.forasurveyofmorerecentadvancementswerecommende.g.fernandezandvico
2013
nierhaus
2008
.byrestrictingtoahighlystructuredandregularmusicalform
andprovidingalargenumberoftrainingexamples
wemayobtainconvincingmusicalresultsevenwithrathermusic-agnosticmodels
sturmetal.,2015
.alternatively
withsmallerdatasets
morestructuredmodelsarerequired
suchasthehiddenmarkovmodelinvestigatedbyallanandwilliams
2005
.bothofthesemethodsleadtorelativelyconvincingmusicalresults.however
theplausibilityofc
cid:13
2017c.walder
d.kim
walderkimtheresultscomesatthecostofvariety.itisunreasonabletoexpectsuchapproachestogiverisetointerestingnewmusicalforms.unmannedmachinelearningalgorithmscapableofdivininginterestingnewmusicalformsmayarise
butthisisfarfromarealityatthetimeofwriting.inanycase
hybridman-machinesystemsareapromisingavenueforexploration.thehighlevelgoalisasystemforthepartialspeciﬁcationofmusic
whichrelinquishesprecisecontrolforothergains.1inthiswork
weinvestigatethecombinationofmachinelearningmusicmodelswithhumaninput.ourapproachismostcloselyrelatedtotheworkofpapadopoulosetal.
2015
whoimposetheconstraintthattheresultingsequencebeamemberofalanguagedeﬁnedbyaﬁnitestatemachine.thisisarathergeneralconstraintwhichprovidesarichlanguageforhumancreativityviathepartialspeciﬁcationsofmusic.inthatwork
thecloserelationshipbetweenmarkovmodelsandﬁnitestatemachineswasusedtoderiveasimplebutexactbeliefpropagationalgorithm.here
werelaxtheconstraintthatourunderlyingsequencemodelbemarkovian
andinsteadmakeuseofapproximatesamplingtechniques
namelythatofsequentialmontecarlo
smc
gordonetal.,1993
doucetandjohansen,2009
.inadditiontosampling
wecompareandcontrastwithamaximumconditionalprobabilityapproachbasedonabeamsearch.
giventheﬁnitestatemachineconstraint
.byallowingmodelswhicharenotlow-ordermarkovian
weobtainalgorithmswhichareapplicabletoabroadrangeofmoreexpressiveprobabilisticmodelsofmusic.concretely
hereweadoptthelongshort-termmemory
lstm
basedneuralnetworksequencemodel
hochreiterandschmidhuber,1997
.byexploitingadvancesinmassivelyparallelcomputingarchitectures
thisclassofmodelshasprovenremarkablyeﬀectiveinarangeofdomains
mostnotablynaturallanguagemodeling
seee.g.chelbaetal.
2013
.giventhesimilaritiesbetweenmusicandnaturallanguage
patel,2010
itisunsurprisingthatthelstmisanaturalmodelformusicdata.thiswasnotedbyhochreiterandschmidhuber
1997
intheoriginallstmpaper
andsubsequentlyinvestigatedbyeckandschmidhuber
2002
.thislineofworkhasbeentakenupbyanumberofresearchers
withrecentexamplesincludinge.g.boulanger-lewandowskietal
2012
walder
2016
thelatterapproachbeingtheoneweadopthere.insection2wesettheproblemupandmotivateoursolution.weprovidetechnicaldetailsoftheapproximatesamplingmethodinsection3.section4providesresultsincludingavisualillustration
quantitativeinvestigation
humanlisteningtest
andaudioexamples.weconcludeinsection5.2.set-upandmotivation2.1.requiredbackgroundwetakethemodelofwalder
2016
asourstartingpoint
andwhilethisworkisanecessaryaccompanimenttothepresentworkforthosewishingtoreplicateourresults
thepresentpaperstandsaloneinthesensethatitmaybeappliedtoanymodelwhichfactorisesinthecausalmannersubsection2.2describedbelow.furthermore
theﬁnitestatemachine1.iwillarguethattoday
scomposersaremorefrequentlygardenersthanarchitectsand
thatthecomposerasarchitectmetaphorwasatransitoryhistoricalblip—eno
2011
computerassistedcompositiondescriptiona
symbolicmusicdatawithﬁveeventsb
xxxxx12345ttttt12345ddddd12345conditionalx4|x1:3
t1:5
d1:5availablein
xxxxx12345ttttt12345ddddd12345allbutx2andx3areobservedfigure1
anoverviewofoursystem
pleaserefertosection2formoredetailsonthebackground.symbolicmusicconsistingofﬁveevents
rowa—notethattherestsorsilencesarenotcounted
isrepresentedbyasequenceofﬁvenotenames
roughlyspeaking
indicesintoapianokeyboard
x1:5
alongwithstarttimest1:5anddurationsd1:5.followingwalder
2016
wemodeltheconditionalx1:5|t1:5
d1:5
withacausalfactorisationoverx1:5asindicatedbythediagram
rowb
andtheequation
.rowcdepictsthesimplestsettingweconsider
whereinthehumaninputamountstothepartialobservationofthesequencex1:5
seesubsection3.1
.inthecasedepictedinrowc
weinfersomeﬁxedsubsetofthenotes
x2andx3
giventhevaluesforalltheothervariables.theresultingconditionalx2
x3|x1
t1:5
d1:5isnon-trivialduetoobservedfuturevalues
whicharenotdirectlyhandledbytheconditionalswhichweexplicitlymodelviathecausalfactorisation
.inrowsb–ctheboxaroundt1:5andd1:5ismeanttodenotethattheout-goingarrow
emanatefromallthevariablesinthebox.constraintformalismweadoptiscloselyrelatedtopapadopoulosetal
2015
whichwealsorecommendasbackgroundmaterial.3
walderkim2.2.assumedmusicmodelwerepresentamusicalcompositionbyasetofntriples
ni=1⊂x×t×t.here
xrepresentsthesetofpossiblepitches
fromthe12-tetwesternmusicalsystem
includingboththenotenameandoctave
.thesettrepresentstime
withtianddidenotingthestarttimeanddurationofthei-thnoteevent
respectively.followingwalder
2016
weassumethroughoutthatthetiminginformationisgiven
sothatwehaveamodelp
ni=1|n
ni=1
.thismodelpisbasedonareductiontoanon-markovsequencemodel.thismeansthat
forsomeparticularorderingoftheindices
seewalder
2016
neglectingtheconditioningon
mi=1
wehavep
=nyi=1fi
xi|x1
i−1
wheretheconditionalsfiarerepresentedexplicitly.2.3.assumptionoffixedrhythmicinformationideallywewouldmodeltherhythmicstructure
butthisturnsouttoberatherchallenging.indeed
modelingpitchesgiventherhythmicstructureisalreadyrathernon-trivial
soitisreasonabletosubdividetheproblem.notethatsomeauthorshavemodeledtiminginformation
byassuminge.g.1.asimplenoteon/oﬀrepresentationonauniformtemporalgridasine.g.boulanger-lewandowskietal.
2012
whichassumedatemporalresolutionofaneighthnote.thishasthedrawbackofnotdistinguishing
say
twoeighthnotesfromasinglequarternote
whichhaslengthtwoeighthnotes
.2.ratherthanexplicitlyprocessingeachtimesteponaﬁxedtemporalgrid
onemaymodeltimeincrementsasincolomboetal
2016
simonandoore
2017
.inthiscasesamplingconditionallygivenconstraintsasisourpresentfocusbecomesmoretechnical.indeed
pointprocessmachinery
daleyandvere-jones,2003
isrequired
duetothevariabledimensionoftheparameterspace
thatis
thenumberofnotes
.thesamplingproblemsanalogoustothepresentworkbecomehighlynon-trivialinthatcase.thisisthesubjectofongoingwork
andbeyondthepresentscope.shortofdevelopingthesecondapproach
assumingﬁxedtiminghastheadvantageofallowingarbitrarilycomplexrhythmicstructures.inthisway
ratherthanfullymodelinganoverlysimplisticmusicrepresentation
wepartiallymodelamorerealisticmusicrepresentation.oncewehavesatisfactorilymodeledtiming
ourmethodsandﬁndingsmaybegeneralisedtothefulljointdistribution
aswecanalwaysemploythechainruleofprobabilitytodecomposep
ni=1
ni=1|n
ni=1
ni=1
wheretheﬁrstfactoronther.h.s.isourpresentconcern.4
computerassistedcomposition2.4.finitestatemachineconstraintformulation3.sequentialmontecarlodetailswedescribedetailedsequentialsamplingmethods.insubsection3.1weconsiderpartiallyobservedsequences
andtheninsubsection3.2weextendthistomoregeneralconstraintsrepresentedbyanarbitraryﬁnitestatemachine.throughoutthissectionweneglectconditioningonthestarttimestianddurationsdi
astheyareﬁxedthroughout.3.1.partiallyobservedsequencesletx1
nbeasequencedrawnfromthenon-markovprocesswithdiscretestate-spacex.p
∝γn
=nyi=1fi
xi|x1
i−1
whereγnisanun-normalisedprobabilitydistributionwhichcanbefactorisedintotheconditionalsfi
eachofwhichdependsonallofthepreviousstatesx1
i−1.ourgoalistocomputetheposteriorofx1
nwithpartialobservations˜x.letzibe1ifxiisobservedand0otherwise.theposteriordistributionoftheunobservedpartis
zi=0|
˜xj
zj=1
zj=1
∝qni=1fi
xi|x1
i−1
pxi∈x
zi=0qni=1fi
xi|x1
i−1
whereweletx1
nbethefullsequencewiththepartialobservations.eventhoughourstatespacexisﬁnite
na¨ıvelyevaluatingtheprobabilityofapartiallyobservedsequencewouldinvolvecomputing|x|pi
1−zi
terms
sothatthecomputationalcostisexponentialwithrespecttothenumberofunobservednotes.toresolvethiscomputationalproblem
wedevelopemployastandardparticleﬁlterapproach
doucetandjohansen,2009
section3.2
.onecanapproximatetheposteriorofx1
nbyimportancesamplingwithfullyfactorisedproposaldistributionq
=qni=1qi
xi|x
sothatγn
=wn
=wn
pxi∈x
∀i=1,2
...
nwn
.withssamplesx
nfromq
theposteriorcanbeapproximatedbyanempiricalmeasureofthesamples
n|z1
=sxs=1wn
pss0=1wn
walderkimtheweightofeachsamplex
n∼q
=γn
=qni=1fi
i|x
i−1
=˜γn−1
n−1
n−1
wn−1
n−1
×fn
n|x
n−1
n|x
theaboverecursiondeﬁnestheparticleﬁlterscheme
doucetandjohansen,2009
.forourparticularcaseofpartialobservations˜x
wedeﬁnetheproposalqi
xi|x
cid:20
δ˜xi
cid:21
cid:20
xi|x
i−1
cid:21
1−zi
sothatourproposalalwaysproposes˜xjwheneverthesamplerencountersthepartialobservation.thenfrom
wehavethattheweightofsamplex
i∼qi
iswi
1zi=0fi
i|x
i−1
zi=1
thisexpressionisintuitive
wesampleintemporalorderusingouroriginal
unconstrained
model
andre-weightourparticlesonlywhenencounteringanobservedsymbol
orconstraint
givingmoreweighttothoseparticleswhosehistorybetteragreeswiththeobservedsymbol
asmeasuredbytheconditionalfi.thisalgorithmisaspecialcaseofthatofthefollowingsubsection
forwhichpseudo-codeisprovidedasalgorithm1.3.2.generalconstraintshereweextendtheset-upoftheprevioussectiontothemoregeneralcaseofsamplingwiththehardconstraintthatthesampledsequenceliewithinagivenregularlanguage.inparticular
wewishtosamplefromp
n|x1
n∈l
n∈ln
,0otherwise.
isthesetofsequencesoflengthngeneratedbyﬁnitestatemachinea=hq
whereqisasetofstates
σanalphabetofactions
δthetransitionfunctionlinkingastateq∈qandalabela∈σtothesuccessorstateq0=δ
q0∈qtheinitialstate
andf⊆qthesetofterminalstates.wehavex=σinourcase.similarlytopapadopoulosetal
2015
werewritep
∝nyi=1fi
xi|x1
i−1
computerassistedcompositionwherehi
1x1
i∈li
,0otherwise
papadopoulosetal
2015
transformedtheirsimilarproblemintooneinvolvingthecartesianproductofthedomainofthexiandthestatespaceofatoobtainatreestructuredfactorgraphforwhichbeliefpropagationiseﬃcient.weareinterestedinnon-markovpandhencehavenothingtogainfromsuchatransformation.instead
wesimplyencodethelanguagemembershipconstraintviathegeneralfunctionshiandproceedwithsmcasusual.2now
wegeneralise
ofbychoosingq
xi|x1
i−1
=1zq
i−1
xi|x1
i−1
wherezq
i−1
=pxi∈xfi
xi|x1
i−1
.there-samplingweightsarederivedsimilarlyto
yielding
uptoanirrelevantconstanttowhichsystematicresample
carpenteretal.,1999
ofalgorithm1isinvariant
=zq
i−1
=x˜xi∈xfi
˜xi|x
i−1
where˜x
iistheconcatenationofx
i−1and˜x
i.hence
reducesto
forunaryconstraints.theaboveexpressionisintuitive—ifallthehi
areone
theweightsareonesowesamplefrompwithoutmodiﬁcation.inothercases
wegivegreaterweighttothoseparticlesforwhichthetotalprobabilitymassofadmissiblecontinuationsisgreater.theoverallprocedureissummarisedbyalgorithm1.forconcreteness
weprovidetwoexamplesofﬁnitestatemachineformulation.itisnotcrucialtounderstandtheseexamplesindetailhowever
aswemayalsoformulateouruserconstraintsbyspecifyingthehiofequation3.2directly.example1
sequencewithunaryconstraints
weimposeunaryconstraintsateachtimeioflength-nsequence.takea=hq
whereeachtimeihasone-to-onecorrespondingstateqi.letxibeasetofacceptablenotesattimei.withtransitionfunctionδ
xi+1
=qi+1ifxi+1∈xi+1
weonlyallownotesinxn+1andrejectsnotesnotinxi+1.furthermorechoosetheterminalstatesftobe
.hence
machineaonlyacceptslength-nsequenceswhichsatisfypredeﬁnedunaryconstraintsxi.forexample
inthepartiallyobservedsequencecase
xi=
˜xi
ifzi=1andxi=xifzi=0.notethatthispartiallyobservedconstraintisaspecialcaseofgeneralunaryconstraintswherexiconsistsofsingleobservation˜xi.example2
prohibitrepeatednotes
onecandisallowconsecutivepositionsfromhav-ingthesamenoteasfollows.letthenumberofstatesbeequaltothenumberofpossiblenotes|x|
andeachstateqxbeindexedbyx.choosethetransitionfunctionδ
qxi
=qxjifxi6=xj.aonlyacceptssequenceswhichdoesnothavethesametwoconsecutivenotes.2.however
sinceweonlyeverappendanxitoagivenparticle
wemayleveragetheﬁnitestatemachineformulationofainordertoevaluatethehi
typicallyino
walderkimparticlefilter5075midipart
15075part
25075part
301020304050time
quarter
notes
5075part
40.20.40.60.81.0final
path
distributionbeamsearch6080midipart
16080part
26080part
301020304050time
quarter
notes
6080part
40.20.40.60.81.0final
path
distributionfigure2
visualisationoftheﬁnalstateoftheparticleﬁlter
upper
andbeamsearch
lower
withs=2048paths.inbothcasesthefourthpart
lowestsubﬁgure
isﬁxedtotheoriginalfromcorelli
strioop1no1
whichactuallycontainsfourmiditracks
providedbyboulanger-lewandowskietal.
2012
hencethefourthpartappearsaboveasadeterministicdistribution
withprobabilitymassoneonasinglenoteateachtimestep.thepitches
verticalaxis
ofparts1–3wereunconstrained
tobedeterminedbyouralgorithms.fortheparticleﬁlter
theplotteddistributionisasequentialmontecarloapproximationoftheﬁlteringdistribution
giventhatweconsidertheﬁnaltimestep
isalsothesmoothingdistribution
.forthebeamsearch
theplotteddistributionissimplythesetofthecandidatepathsmaintainedbythedeterministicsearchalgorithmatitsﬁnalstep.notethatthepartnumbers
whichcorrespondingtotheaxesabove
andwhichcomefromtheoriginalcomposition
areusedonlyforplottingandnotbyouralgorithms.followingpapadopoulosetal
2015
weformulatehumaninputastheconstraintthatthesequencex1
nbelongtothelanguageofanarbitraryﬁnitestatemachine
a.thishastheadvantageofbeingextremelygeneral
yetamenabletobeliefpropagation
formarkov8
computerassistedcompositionpasinpapadopoulosetal.
2015
andparticleﬁltering/beamsearch
asinthepresentwork
.theexperimentsinsection4utiliseafractionofthegeneralityofthisapproach.weenvisagearichsetofconstraintswhichusersmayexperimentwithtodiscoverinterestingnewmusic
andouralgorithmsfacilitatethis.onemightenforcetherepetitionofpatterns
transformrelationshipsbetweensub-sequences
suchasinversion/retrograde
andsoon
witharbitrarilycompleximplicationssuchasoddpoly-metricalpatterns
etc.concreteexamplesaregivenbyroyandpachet
2013
whichimposesmetricalstructure
andpapadopoulosetal
2016
whichavoidstheexactrepetitionoftrainingsub-sequences.3.3.harmonisationbysampling/optimisationweconsidertwoalternativemeansofincorporatingtheconstraintoftheprevioussubsection.theﬁrstisconditionalsampling
fromp
n|x1
n∈l
wherel
isthesetofsequencesacangenerate.thesecondismaximisationofthesameconditionalprobabilitywithrespecttox1
n.thenatureof
issuchthatgivenapartialsequencex1
i−1wemaykeeptrackofalatentvariable
thelstmstatevector
inordertocomputefi
xi|x1
i−1
intimeindependentofi.thestatevectormayalsobeupdatedintimeindependentofi
whenanewelementxiisappended.thisstructuremakessmcthenaturalchoiceforsampling
sinceitonlyeverrequiresextendingagivensequencebyasingleelement.section3providesthedetails.thisapproachisincontrasttoe.g.hadjeresandpachet
2017
whereinasimplerconditionalindependencestructureisassumed
alocaldependencynetwork
makingsamplingsimplerbutprecludingthemodellingoflongerrangedependenciesascapturedbythelstm.similarly
beamsearchmethodsarenaturalformaximisingtheconditionalprobability.inthiscasewemaintainscandidatepaths
andextendeachpathbyonenewelementeachtimestep
forallfeasiblecontinuations
retainingthesmostprobableresultingsequences.4.resultsthroughouttheexperiments
weemployﬁnitestatemachineswhichmerelyﬁxcertainnotesxitogivenvalues
andpreventunisonintervalsfromoccurringwithinasinglepart
whichwouldbeimpossibletoplayonthepiano
forexample
.4.1.visualisationawellknowndiﬃcultyinparticleﬁlteringisthecollapsingoftheparticlestoasmallnumberofuniquepaths.weobservelittleevidenceofthisinoursettinghowever
whichfeaturesareasonabledegreeofuncertaintyintheﬁnalparticledistribution
figure2
upperplot
.asexpected
thebeamsearch
figure2
lowerplot
behavesverydiﬀerently
withthemajorityofthesolutionsbeingidenticalotherthanatafewisolatedtemporalintervals.4.2.quantitativeinvestigationboththebeamsearchandparticleﬁlteralgorithmshaveasinglekeyfreeparameters
thenumberofpathstostore
whichtradesaccuracyforcomputationtime.inthissubsection
weinvestigatethistrade-oﬀ.forcomputationalreasons
werestrictedouranalysistothe9
walderkim100101102103number
paths3.02.52.01.51.0mean
per-note
log
probabilityground
truth
filtering
log
probability100101102103number
paths1.61.41.21.00.80.6mean
per-note
log
probabilitybest
log
probability1
fixed
parts
particle
filter
fixed
parts
beam
search
fixed
parts
particle
filter
fixed
parts
beam
search
fixed
parts
particle
filter
fixed
parts
beam
search
fixed
partsfigure3
theeﬀectofincreasingthenumberofpaths.left
theﬁlteringprobabilityoftheﬁxed
groundtruth
parts
andright
thebest
maximum
probabilitysequencefoundbythealgorithm.theverticalaxisisthemeanlogprobabilitypermusicalnoteunderoursequencemodel.themean+/-onestandarderrorofthisquantityisdepicted
takenoverthe16piecesweconsider
multipliedbythec4mchoicesofﬁxedparts
wherethenumbermofﬁxedpartsrangesfrom1to4andisdenotedbythecolor.thebeamsearchisplottedinsolidlinesandtheparticleﬁlterinbrokenlines.seesubsection4.2forthedetails.sixteenshortestpieces
bynumberofnotes
fromthosepiecesinthemusedatatestsetfromboulanger-lewandowskietal.
2012
whichconsistofexactlyfourvoices
allofwhichturnedouttobebachchorales
.foreachpiece
andform∈
1,2,3,4
weﬁxedmofthevoicestothatoftheoriginalpiece
andappliedouralgorithmstochoosetheremaining
4−m
parts.wedidthisinallc4mpossibleways
plottinginfigure3themeanandstandarderroroverall16×c4mpossibilitiesoftwodiﬀerentquantities
asafunctionofthenumberofpathss.thetwoquantitiesdepictedare:1.figure3l.h.s.
theﬁlteringprobabilityoftheﬁxedparts—inthenotationofsubsection3.2themeanofthelogofsxs=1w
pss0=1w
xi|x
forallicorrespondingtotheﬁxedvoices.fortheparticleﬁlter
thisisansmcapproximationoftheprobabilityofthegroundtruthfortheﬁxedvoicesconditionalonpreviousobservedvaluesfortheﬁxedvoices.forthebeamsearchweletw
andthequantityheuristicallymeasureshowwellthesetofcandidatepathsagreewiththeﬁxedvoicesonaverage.2.figure3r.h.s
theprobabilityofthebestcompleteharmonisationfoundbythealgorithm.forthebeamsearch
thisisthelogprobabilityoftheﬁnalpathobtained10
computerassistedcomposition0123number
fixed
parts
four
0.00.10.20.30.40.50.60.70.80.91.0binomial
prob
better
original
confidence
intervalsbeamsearchparticlefilterfigure4
resultsfromthelisteningtestdescribedinsubsection4.3.weplot90
conﬁ-denceintervalsfortheprobabilitythatourresultsarepreferredtotheoriginalcompositionsfromwhichtheywerederived.thehorizontalaxisisthenumberofpartswhichwereﬁxedtothevaluesintheoriginalcomposition.weseethatwiththeprovisionofjustonepartfromtheoriginalpiece
wescoreapproximatelyaswellastheoriginalcomposer
i.e.p=0.5
namelybach.bythesearchalgorithm.fortheparticleﬁlter
wetakethemostlikelysolutionfromtheﬁnalsetofparticles.qualitatively
theresultsareasexpected
witheachalgorithmdominatinginthesettingitisintendedfor
theparticleﬁlterissuperiorintermsoftheﬁlteringprobability
whilethebeamsearchproducesmoreprobablesolutions.interestingly
givensuﬃcientlylarges
thebestlogprobabilityexceedsthegroundtruth
4/4ﬁxedparts
redline
.thisindicatesthateitherwearedoingbetterthantheoriginalcomposer
ortheprobabilityunderpdoesnotfullyreﬂectperceivedquality.thelisteningtestinsubsection4.3indicatesthatthelatterisofcoursemostlikely
althoughthisdoesnotnecessarilyimplythatpisinadequate—seesubsubsection4.3.2andfootnote4.quantitatively
weseethatarounds=500pathsarenecessaryinordertoobtaingoodsolutions
thattheparticleﬁltercontinuestoimproveforgreatersintermsofthefigure3righthandsideplotistobeexpectedsincethealgorithmdoesnotexplicitlysearchforthemostlikelysequence
.therequirednumberofpathsissigniﬁcantlymorethanreportedbysutskeveretal.
2014
whoobservedmarginalgainsfors
2.broadlyspeaking
thisdiﬀerenceistobeexpected
locally
thebestmusicalharmonisationmaybehighlyambiguous
requiringmanypathstobemaintainedinorderforthefutureﬁxed
orobserved
notestohaveareasonablechanceofresolvingwellinthemusicalsense.themachinetranslationproblemconsideredbysutskeveretal
2014
islessambiguous
andfurthermorefuturesymbols
words
arenotconditionedonasinoursetting.11
walderkimhyper-linkdescription
melodyoriginalmelodylineinisolation
originalcompleteoriginalcomposition
beamsearchmelodyline+beamsearch
particleﬁltermelodyline+particleﬁltertable1
sampleoutputbasedontheﬁrstmovementofthequartetno.7ineﬂatmajorbymozart.in
theoriginalmelodylineisrenderedbyitselfwithapianotimbre.in
threeadditionalpartsarerenderedwithadistinctclassicalguitarliketimbre.4.3.humanlisteningtestwealsoinvestigatedtheeﬀectivenessofouralgorithmsasjudgedbyhumanevaluators
viaanon-linesurveyusingtheamazonmechanicalturk3.4.3.1.methodologyasthebasisforthesurvey
wegeneratedharmonisationsasintheprevioussubsection4.2
withthenumberofcandidatepathsssetto4096.weexcludedtwoofthesixteenpiecespreviouslyconsidered
duetotheextendeduseofpurepedalpoint
repeatingofasinglenote
inthreeoutoffourvoicesoftheoriginalcompositions
leadingtouninterestingconstraintsinthemajorityofcases.foreachoftheremainingfourteenpiecesandform∈
0,1,2,3
weharmonisedthepieceswithmoutoffourvoicesﬁxed.asbefore
wedidthisallc4mpossibleways
forboththeparticleﬁlterandbeamsearchmethods.eachsuchoutputwascomparedwiththeoriginalpiecefromwhichitwasderived.thiscomparisonwasperformedbytenuniquehumansubjectsperpiece
notthesametenforeachpiece
therewere67uniquerespondents
.thisgaveagrandtotalof14×p3n=0c4n×2×10=4200comparisons
or—ﬁguringconservativelyatoneminutepertest—approximately72hoursoflistening.eachexperimentpresentedtheoriginalandderivedpieceinrandomorder
andaskedtheparticipanttodecidewhichsoundsbetteroverall
toimprovedataqualityweincludedtwoparticipantﬁlters.first
wepresentedpieceswithrandomnotesdrawnfromuniformdistributionoverafouroctaverange
andexcludedsubjectswhofailedtodobetterthanrandomatselectingtheoriginalpieceovertherandompiece.second
wetriedtoﬁlterinsinceresubjectswhorespondedinaveryshorttime.4.3.2.findingsasummaryoftheresultsispresentedinfigure4
whichpresentsfrequentistconﬁdenceintervalsontheunknownbinomialprobability
brownetal.,2002
ofchoosingourpiecesaspreferabletotheoriginal.notethataprobability
verticalaxis
ofgreaterthanonehalfwouldimplythatourresultsareonaveragepreferabletotheoriginalpiece.3.http
//www.mturk.com12
computerassistedcompositionretainedpartparticlefilterbeamsearch4
melody
hyperlink
hyperlink
3hyperlinkhyperlink2hyperlinkhyperlink1
bass
hyperlinkhyperlinktable2
sampleoutputbasedontheﬁrstmovementofthequartetno.7ineﬂatmajorbymozart.similarlytotable1
pleaseseethecorrespondingcaption
weretainedasinglepartascomposedbymozart
andreplacedthepitchesintheremaining3voices.retainedpart
thepartwhichweleftunchangedfromtheoriginal
from4
highestpitch
to1
lowest
particlefilter
thesamplingresult
beamsearch
thebeamsearchresult
isidenticaltothatoftable1
issimilarto
fromtable1
butusedadiﬀerentrandomseed.themostclearresultisthatwithnoﬁxedparts
thebeamsearchalgorithmtendstoproduceinferiorresults.thisisinlinewiththeexperienceofourinformalexperimentationwiththebeamsearchapproachwhich
intheabsenceofﬁxednotestoconditionon
tendedtoproduceoverlyregularpatternsfeaturinglongsequencesofrepeatednotes
etc.thisisnotanerroneousresult
butratheranaturalconsequenceofmaximisingthesequenceprobability
ratherthansamplingfromthedistribution.4itisworthnotingthatthisoverlyregularbehaviourofthebeamsearchmaybeobservednotonlyinthatcaseofunconditionalsampling
butalsoinpieceswherethepartsbeingconditionedonfeaturesuﬃcientlyprotractedperiodsofinactivity
duringwhichthebeamsearchisrelativelyunconstrained
seetheillustrativeexamplesinsubsection4.4
.theparticleﬁlterdoesonlyslightlyworsethanparitywithnoﬁxedparts
butthiseﬀectisnotsigniﬁcantbasedonthesetests.ourowninformalexperimentationindicatedthatthefullyunconstrained
noﬁxedparts
particleﬁltertendstooccasionallyﬁnishpieceswithpoorlyresolvedharmonicmovements—anobservationpartiallycorroboratedbyfigure4.interestingly
bothalgorithmsperformwellgivenevenasingleﬁxedparttoconditionon
withtheparticleﬁlterperformingslightlybutconsistentlybetteroverall
.thisisabroadlysatisfactoryresult
whichindicatesthepossibilityofconstructingconvincingmusicalresultsbyspecifyingasinglevoice
outoffour
alongwiththerhythmicstructureofthepiece.4.3.3.discussiononegoalofourworkistocreatetoolswhichfacilitatetheadvancementofthemusicalartform.webelievethatthismaybebepossible
throughcreativemanipulationoftheconstraintsetbyskilledhumans.ideally
wewouldleveragethesuperhumanabilityofthecomputertosiftthroughlargenumbersofpossiblesolutions.inthisway
constraintsets4.informalthoughtexperiment
considerthestochasticrelationshipyi=xi+n
0,1
.weimaginetheanalogythatthexirepresentthetimingandtheyithepitchofasetofnotesmakingupapiece.themostlikelyyigivenanxiisexactlyyi=xi
andyetforaset
ni=1suchaperfectstraightlineisinsomesensehighlyatypicalofasamplefromtheconditional
ni=1|
ni=1.13
walderkimalgorithm1
sequentialmontecarloforconstrainednon-markovsequences
withsystem-aticre-sampling
carpenteretal.,1999
.functionconstrainedsmc
ni=1
fors←1,2
...
sdox
initialisewithemptysequenceendfori←1,2
...
ndofors←1,2
...
sdosamplex
i∼q
·|x
i−1
proposal
appendws←p˜xi∈xfi
˜xi|x
i−1
endk1
s=systematicresample
ss=1←
ss=1duplicate/deleteparticlesendreturnx
approximatesamplesx
fromp
functionsystematicresample
s←w1
s/pss=1wssampleu∼uniform
0,1
¯u←u/s
j←1
sω←ω1forl←1,2
...
sdowhilesω
¯udoj←j+1sω←sω+ωjendkl←j¯u←¯u+1/sendreturnk1
swhicharetoocomplexandtightlycoupledforhumaninvestigationmayyieldnewmusicalforms.evaluatingsuchaschemeisbeyondthepresentscope
likelyrequiringanentirelydiﬀerentapproachthanthesimplelisteningtestundertakenhere
seeloughranando
neill
2016
foradiscussionofthechallenges
.theseexperimentsareintendedmerelytoverifythatoursystemcanproducefeasiblesolutionsgivenasimplisticconstraintset.4.4.illustrativeexamplefinally
intable1weprovidesampleaudiooutputfromboththeparticleﬁlterandbeamsearchalgorithms.todemonstratethenatureofthealgorithms
wetookastringquartetbymozart
ﬁxedthemelodyline
andre-harmonisedthethreeremainingpartsgiventheiroriginalrhythmicstructure
noteonsetandoﬀsettimes
.theresultsaretypicalofthebehaviourofthealgorithms.inparticular
thebeamsearchproducesmorerepetitiveresultsthantheparticleﬁlter.todemonstraterobustness
table2providesfurtherre-harmonisations.themethodologyisidenticaltothatofthepreviousparagraph
inthiscasehoweverwevarywhichvoicewasﬁxedtotheoriginalcompositionofmozart
whilere-harmonisingtheremainingthree.14
computerassistedcomposition5.conclusionswepresentedalgorithmsforcombiningsophisticatedprobabilisticmodelsofpolyphonicmusicwithhumaninput.werepresenthumaninputasaﬁnitestatemachinewhichacceptsallowedcompositions.suchaconstraintisrathergeneral
andyetamenablebothtosequentialmontecarlo
forsamplingfromimpliedconditionaldistribution
andbeamsearchoptimisation
formaximisingthesameconditionaldistribution
.wedemonstratedtheeﬃcacyofthemethodsbothquantitativelyandthroughalisteningexperimentwithhumansubjects.whentheconstraintsarehighlypermissive
itseemsthatconditionalsamplingshouldbepreferredtoprobabilitymaximisation
asthelattertendstoproduceoverlyregularresultsinthiscase.furthermore
thetwoapproachesleadtoadiﬀerentstyleofmusicalresult
asexempliﬁedbytheincludedaudioexample.referencesmorayallanandchristopherk.i.williams.harmonisingchoralesbyprobabilisticinference.advancesinneuralinformationprocessingsystems17,2005.nicolasboulanger-lewandowski
yoshuabengio
andpascalvincent.modelingtemporaldependenciesinhigh-dimensionalsequences
applicationtopolyphonicmusicgenerationandtranscription.ininternationalconferenceonmachinelearning,2012.lawrenced.brown
t.tonycai
andanirbandasgupta.conﬁdenceintervalsforabinomialproportionandasymptoticexpansions.annalsofstatistics,30
:160–201,22002.doi:10.1214/aos/1015362189.j.carpenter
p.cliﬀord
andp.fearnhead.improvedparticleﬁlterfornonlinearproblems.ieeproc.
radarsonarnavig.,146
:2,1999.ciprianchelba
tomasmikolov
mikeschuster
qige
thorstenbrants
andphillippkoehn.onebillionwordbenchmarkformeasuringprogressinstatisticallanguagemodeling.corr
abs/1312.3005,2013.floriancolombo
samuelp.muscinelli
alexseeholzer
johannibrea
andwulframgerstner.algorithmiccompositionofmelodieswithdeeprecurrentneuralnetworks.incomputersimulationofmusicalcreativity,2016.d.j.daleyandd.vere-jones.anintroductiontothetheoryofpointprocessesvolumei
elementarytheoryandmethods.springer
secondedition,2003.isbn0-387-95541-0.arnauddoucetandadammjohansen.atutorialonparticleﬁlteringandsmoothing
fifteenyearslater.handbookofnonlinearﬁltering,12
656-704
:3,2009.douglaseckandjuergenschmidhuber.aﬁrstlookatmusiccompositionusinglstmrecurrentneuralnetworks.istitutodallemolledistudisullintelligenzaartiﬁciale,2002.brianeno.composersasgardeners.https
//vimeo.com/55969912,2011.accessed
july2015
transcriptscanbefoundonline
.15
walderkimjosed.fernandezandfranciscoj.vico.aimethodsinalgorithmiccomposition
acomprehensivesurvey.j.artif.intell.res
jair
,48:513–582,2013.n.j.gordon
d.j.salmond
anda.f.m.smith.novelapproachtononlinear/non-gaussianbayesianstateestimation.ieeeproc.radarandsignalprocessing,140
:107–113,1993.gatanhadjeresandfrancoispachet.deepbach
asteerablemodelforbachchoralesgeneration.ininternationalconferenceonmachinelearning,2017.sepphochreiterandj¨urgenschmidhuber.longshort-termmemory.neuralcomputation,9
:1735–1780
november1997.issn0899-7667.doi:10.1162/neco.1997.9.8.1735.roisinloughranandmichaelo
neill.generativemusicevaluation
whydowelimitto
human
incomputersimulationofmusicalcreativity,2016.luigifedericomenabreaandadalovelace.sketchoftheanalyticalengineinventedbycharlesbabbage.scientiﬁcmemoirs
pages666–731,1843.lawrencem.murray
anthonylee
andpierree.jacob.parallelresamplingintheparticleﬁlter.journalofcomputationalandgraphicalstatistics,2015.gerhardnierhaus.algorithmiccomposition
paradigmsofautomatedmusicgeneration.springerpublishingcompany
incorporated,1stedition,2008.alexandrepapadopoulos
francoispachet
pierreroy
andjasonsakellariou.exactsamplingforregularandmarkovconstraintswithbeliefpropagation.inprinciplesandpracticeofconstraintprogramming
pages341–350,2015.alexandrepapadopoulos
francoispachet
andpierreroy.generatingnon-plagiaristicmarkovsequenceswithmaxordersampling.increativityandunivers.inlanguage,2016.a.d.patel.music
language
andthebrain.oxforduniversitypress,2010.isbn9780198028772.pierreroyandfrancoispachet.enforcingmeterinﬁnite-lengthmarkovsequences.inaaaiconferenceonartiﬁcialintelligence,2013.iansimonandsageevoore.performancernn
generatingmusicwithexpressivetiminganddynamics.https
//magenta.tensorflow.org/performance-rnn,2017.bobsturm
jo˜aofelipesantos
andirynakorshunova.folkmusicstylemodellingbyrecurrentneuralnetworkswithlongshorttermmemoryunits.inismirdemo,2015.ilyasutskever
oriolvinyals
andquocvle.sequencetosequencelearningwithneuralnetworks.inneuralinformationprocessingsystems27
pages3104–3112,2014.christianwalder.modellingsymbolicmusic
beyondthepianoroll.inthe8thasianconferenceonmachinelearning
acml
pages174–189,2016.16
